<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>后台-获取文章</title>
</head>

<link rel="stylesheet" href="/public/css/adminStyle.css"> 
<link rel="stylesheet" type="text/css" href="/public/css/page.css"/>
<link rel="stylesheet" type="text/css" href="/public/css/layui.css"/>
<script type="text/javascript" src="/public/js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="/public/js/layer/layer.js"></script> 
<script src="/public/js/layer/layui.js"></script>

<style>

    .layui-btn{
        margin-right: 30px;
    }
    .layui-form-checkbox{
        margin-right:5px!important;
        margin-top: -4px!important;
    }
</style>
<body>


<div class="right">
	<div class="meau22">
        <div class="xt_title">后台管理</div>
        <div class="top-link">
            <a href="#" target="mainCont" title="DeathGhost">
                <i class="adminIcon"><img src="/public/images/user_01.png"></i><span><b>你好,{$uname}</b>欢迎使用管理系统</span></a>
            <a href="/admin/login/logout" class="tuichu" title="退出"><img src="/public/images/tuichu.gif"></a>
        </div>
    </div>
    <div class="clear"></div>
    <div class="main1">
		{include file="layer/top"}
        <div class="clear"></div>


        <div class="clear"></div>
        <div class="biaoge layui-form">
        	<table width="100%" border="1" cellspacing="0" cellpadding="0">
        	<tr class="ddbg">
        	    <td height="45" align="center" valign="middle">开始页</td>
        	    <td height="45" align="center" valign="middle">结束页</td>
        	    <td height="45" align="center" valign="middle">操作</td>
      	    </tr>
            <tr>
                <td height="50" width="50" align="center" valign="middle">
                    <div class="layui-form-item">
                        <label class="layui-form-label">输入框</label>
                        <div class="layui-input-block">
                          <input type="number" name="str" required  lay-verify="required" placeholder="请输入开始页" value="{$start_page}" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </td>
                <td height="50" width="50" align="center" valign="middle">
                    <div class="layui-form-item">
                        <label class="layui-form-label">获取页数</label>
                        <div class="layui-input-block">
                          <input type="number" name="page" required  lay-verify="required" placeholder="请输入获取页数" value="{$page}" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </td>
                <td height="50" align="center" valign="middle">
                    <button class="layui-btn  layui-btn-normal" onclick="getALLByPage()" >根据分页获取文章</button>
                    <button class="layui-btn layui-btn-normal" onclick="getALLByPageAuto()" >自动</button>
                </td>
            </tr>
            <tr>
                <td height="50" width="50" align="center" valign="middle">
                    已存在文章：<span id="number_1">{$number_1}</span>
                </td>
                <td height="50" width="50" align="center" valign="middle">
                    已获取内容文章：<span id="number_2">{$number_2}</span>
                </td>
                <td height="50" align="center" valign="middle">
                    <button class="layui-btn  layui-btn-normal" onclick="getInfo20Url()" >一键获取20个文章</button>
                    <button class="layui-btn  layui-btn-normal" onclick="getInfo20UrlAuto()" >自动</button>
                </td>
            </tr>
      	  </table>
        </div>
        <div class="clear"></div>
        <div class="clear"></div>
       
    </div>
    <div class="banquan">CopyRight 2014-2018  有限公司版权所有</div>
</div>

<script>  
    function getALLByPage(){
        //loading层
        var index = layer.load(1, {
          shade: [0.1,'#fff'] //0.1透明度的白色背景
        });
        var page_str  =     parseInt($("input[name=str]").val());
        var page      =     parseInt($("input[name=page]").val());
        $.ajax({
           type: "POST",
           url: "/admin/index/getALLByPage",
           data: {
                'page_str'      : page_str,
                'page'          : page,
           },
            success: function(msg){
                layer.close(index); 
                if (msg.code==1) {
                    $("input[name=str]").val(page_str+page)
                    layer.alert("共插入"+msg.msg+"条数据");
                }else if(msg.code==2){
                    layer.alert("查询完成，没有数据了，共查询到"+(msg.msg-1)+"页");
                }else{
                    layer.msg(msg.msg,{
                      icon: 2,
                      time: 1000 //2秒关闭（如果不配置，默认是3秒）
                    })
                }
            }
        }); 
    }    
    function getALLByPageAuto(){
        //loading层
        var index = layer.load(1, {
          shade: [0.1,'#fff'] //0.1透明度的白色背景
        });
        var page_str  =     parseInt($("input[name=str]").val());
        var page      =     parseInt($("input[name=page]").val());
        $.ajax({
           type: "POST",
           url: "/admin/index/getALLByPage",
           data: {
                'page_str'      : page_str,
                'page'          : page,
           },
            success: function(msg){
                layer.close(index); 
                if (msg.code==1) {
                    $("input[name=str]").val(page_str+page)
                    layer.msg("共插入"+msg.msg+"条数据");
                    getALLByPageAuto();
                }else if(msg.code==2){
                    layer.alert("查询完成，没有数据了，共查询到"+(msg.msg-1)+"页");
                }else{
                    layer.msg(msg.msg,{
                      icon: 2,
                      time: 1000 //2秒关闭（如果不配置，默认是3秒）
                    })
                }
            }
        }); 
    }    
    function getInfo20Url(){
        //loading层
        var index = layer.load(1, {
          shade: [0.1,'#fff'] //0.1透明度的白色背景
        });
        $.ajax({
            type: "POST",
            url: "/admin/index/getInfoAll",
            dataType:'json',
            success: function(msg){
                layer.close(index); 
                if (msg.code==1) {
                    $("#number_1").html(msg.number_1);
                    $("#number_2").html(msg.number_2);

                    layer.open("共获取："+msg.msg+"条文章内容");
                }else{
                    layer.msg(msg.msg,{
                      icon: 2,
                      time: 100000 //2秒关闭（如果不配置，默认是3秒）
                    })
                }
            }
        }); 
    }

    function getInfo20UrlAuto(){
        //loading层
        var index = layer.load(1, {
          shade: [0.1,'#fff'] //0.1透明度的白色背景
        });
        $.ajax({
            type: "POST",
            url: "/admin/index/getInfoAll",
            dataType:'json',
            success: function(msg){
                layer.close(index); 
                if (msg.code==1) {
                    $("#number_1").html(msg.number_1);
                    $("#number_2").html(msg.number_2);
                    
                    layer.msg("共获取："+msg.msg+"条文章内容");
                    getInfo20UrlAuto();
                }else{
                    layer.alert(msg.msg,{
                      icon: 2,
                      time: 100000 //2秒关闭（如果不配置，默认是3秒）
                    })
                    getInfo20UrlAuto();
                }
            }
        }); 
    }

</script>
</body>
</html>